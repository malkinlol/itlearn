@model List<Course>
@{
    ViewData["Title"] = "SearchCourse";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@inject ApplicationContext _context;

@{
    var Blockchain = await _context.SubcategoryCourses.Where(x => x.CategoryCourseId == 1).ToListAsync();
    var Business = await _context.SubcategoryCourses.Where(x => x.CategoryCourseId == 2).ToListAsync();
    var Coding = await _context.SubcategoryCourses.Where(x => x.CategoryCourseId == 3).ToListAsync();
    var DateScience = await _context.SubcategoryCourses.Where(x => x.CategoryCourseId == 4).ToListAsync();
    var Design = await _context.SubcategoryCourses.Where(x => x.CategoryCourseId == 5).ToListAsync();
    var PersonalDev = await _context.SubcategoryCourses.Where(x => x.CategoryCourseId == 6).ToListAsync();
}


<div class="container mb-5">
    <div class="row mt-5 mb-3">
        <h2>Поиск курсов</h2>
    </div>
    <div class="row">
        <div class="col-md-3 bg-light" style="height: 200vh; ">
            @using (Html.BeginForm("SearchCourse", "Home", FormMethod.Get))
            {
                <div class="mt-3">
                    <p>
                        <svg class="svg-icon" viewBox="0 0 20 20" height="30" width="30">
                            <path d="M6.176,7.241V6.78c0-0.221-0.181-0.402-0.402-0.402c-0.221,0-0.403,0.181-0.403,0.402v0.461C4.79,7.416,4.365,7.955,4.365,8.591c0,0.636,0.424,1.175,1.006,1.35v3.278c0,0.222,0.182,0.402,0.403,0.402c0.222,0,0.402-0.181,0.402-0.402V9.941c0.582-0.175,1.006-0.714,1.006-1.35C7.183,7.955,6.758,7.416,6.176,7.241 M5.774,9.195c-0.332,0-0.604-0.272-0.604-0.604c0-0.332,0.272-0.604,0.604-0.604c0.332,0,0.604,0.272,0.604,0.604C6.377,8.923,6.105,9.195,5.774,9.195 M10.402,10.058V6.78c0-0.221-0.181-0.402-0.402-0.402c-0.222,0-0.402,0.181-0.402,0.402v3.278c-0.582,0.175-1.006,0.714-1.006,1.35c0,0.637,0.424,1.175,1.006,1.351v0.461c0,0.222,0.181,0.402,0.402,0.402c0.221,0,0.402-0.181,0.402-0.402v-0.461c0.582-0.176,1.006-0.714,1.006-1.351C11.408,10.772,10.984,10.233,10.402,10.058M10,12.013c-0.333,0-0.604-0.272-0.604-0.604S9.667,10.805,10,10.805c0.332,0,0.604,0.271,0.604,0.604S10.332,12.013,10,12.013M14.629,8.448V6.78c0-0.221-0.182-0.402-0.403-0.402c-0.221,0-0.402,0.181-0.402,0.402v1.668c-0.581,0.175-1.006,0.714-1.006,1.35c0,0.636,0.425,1.176,1.006,1.351v2.07c0,0.222,0.182,0.402,0.402,0.402c0.222,0,0.403-0.181,0.403-0.402v-2.07c0.581-0.175,1.006-0.715,1.006-1.351C15.635,9.163,15.21,8.624,14.629,8.448 M14.226,10.402c-0.331,0-0.604-0.272-0.604-0.604c0-0.332,0.272-0.604,0.604-0.604c0.332,0,0.604,0.272,0.604,0.604C14.83,10.13,14.558,10.402,14.226,10.402 M17.647,3.962H2.353c-0.221,0-0.402,0.181-0.402,0.402v11.27c0,0.222,0.181,0.402,0.402,0.402h15.295c0.222,0,0.402-0.181,0.402-0.402V4.365C18.05,4.144,17.869,3.962,17.647,3.962 M17.245,15.232H2.755V4.768h14.49V15.232z"></path>
                        </svg> <b class="mr-4">Фильтр</b>
                        <input type="submit" class="btn btn-warning ml-5" value="Поиск" />
                    </p>

                    <hr />
                </div>
                <div class="mt-3">
                    <p>
                        <b>Тема</b>
                    </p>
                    <div>
                        <p><b>Блокчейн</b></p>
                        @foreach (SubcategoryCourse course in Blockchain)
                        {
                            <div>
                                <input type="checkbox" id="@course.SubcategoryCourseId" name="theme" value="@course.SubcategoryCourseId" />
                                <label for="@course.SubcategoryCourseId" class="ml-2 mr-2">@course.Name</label>
                            </div>
                        }
                        <p><b>Бизнес</b></p>
                        @foreach (SubcategoryCourse course in Business)
                        {
                            <div>
                                <input type="checkbox" id="@course.SubcategoryCourseId" name="theme" value="@course.SubcategoryCourseId" />
                                <label for="@course.SubcategoryCourseId" class="ml-2 mr-2">@course.Name</label>
                            </div>
                        }
                        <p><b>Кодирование</b></p>
                        @foreach (SubcategoryCourse course in Coding)
                        {
                            <div>
                                <input type="checkbox" id="@course.SubcategoryCourseId" name="theme" value="@course.SubcategoryCourseId" />
                                <label for="@course.SubcategoryCourseId" class="ml-2 mr-2">@course.Name</label>
                            </div>
                        }
                        <p><b>Наука о данных</b></p>
                        @foreach (SubcategoryCourse course in DateScience)
                        {
                            <div>
                                <input type="checkbox" id="@course.SubcategoryCourseId" name="theme" value="@course.SubcategoryCourseId" />
                                <label for="@course.SubcategoryCourseId" class="ml-2 mr-2">@course.Name</label>
                            </div>
                        }
                        <p><b>Дизайн</b></p>
                        @foreach (SubcategoryCourse course in Design)
                        {
                            <div>
                                <input type="checkbox" id="@course.SubcategoryCourseId" name="theme" value="@course.SubcategoryCourseId" />
                                <label for="@course.SubcategoryCourseId" class="ml-2 mr-2">@course.Name</label>
                            </div>
                        }
                        <p><b>Личное развитие</b></p>
                        @foreach (SubcategoryCourse course in PersonalDev)
                        {
                            <div>
                                <input type="checkbox" id="@course.SubcategoryCourseId" name="theme" value="@course.SubcategoryCourseId" />
                                <label for="@course.SubcategoryCourseId" class="ml-2 mr-2">@course.Name</label>
                            </div>
                        }
                    </div>

                </div>
                <div class="mt-3">
                    <p>
                        <b>Уровень мастерства</b>
                    </p>
                    <hr />
                    <div>
                        <input type="checkbox" id="levelall" name="level" value="Все" />
                        <label for="levelall" class="ml-2 mr-2">Все уровни</label>
                    </div>
                    <div>
                        <input type="checkbox" id="level1" name="level" value="Низкий" />
                        <label for="level1" class="ml-2 mr-2">Низкий</label>
                    </div>
                    <div>
                        <input type="checkbox" id="level2" name="level" value="Средний" />
                        <label for="level2" class="ml-2 mr-2">Средний</label>
                    </div>
                    <div>
                        <input type="checkbox" id="level3" name="level" value="Высокий" />
                        <label for="level3" class="ml-2 mr-2">Высокий</label>
                    </div>
                </div>
                <div class="mt-3">
                    <p>
                        <b>Рейтинг</b>
                    </p>
                    <hr />
                    <div>
                        <input type="radio" id="rating3" name="rating" value="3" />
                        <label for="rating3" class="ml-2 mr-2">3 & выше</label>
                        <label for="rating3" class="text-warning">★</label>
                        <label for="rating3" class="text-warning">★</label>
                        <label for="rating3" class="text-warning">★</label>
                        <label for="rating3" class="text-secondary">★</label>
                        <label for="rating3" class="text-secondary">★</label>
                    </div>
                    <div>
                        <input type="radio" id="rating4" name="rating" value="4" />
                        <label for="rating4" class="ml-2 mr-2">4 & выше</label>
                        <label for="rating4" class="text-warning">★</label>
                        <label for="rating4" class="text-warning">★</label>
                        <label for="rating4" class="text-warning">★</label>
                        <label for="rating4" class="text-warning">★</label>
                        <label for="rating4" class="text-secondary">★</label>
                    </div>
                    <div>
                        <input type="radio" id="rating5" name="rating" value="5" />
                        <label for="rating5" class="ml-2 mr-2">5</label>
                        <label for="rating5" class="text-warning" style="margin-left: 63px;">★</label>
                        <label for="rating5" class="text-warning">★</label>
                        <label for="rating5" class="text-warning">★</label>
                        <label for="rating5" class="text-warning">★</label>
                        <label for="rating5" class="text-warning">★</label>
                    </div>
                </div>
            }
        </div>
        <div class="col-md-9">
            @*<div class="row float-right">

                    <div>
                        <span>
                            Сортировать:<select class="form-control font-weight-bold" style="width: auto; display:inline; background: none; border: none;">
                                <option>Популярный</option>
                                <option>Новый</option>
                            </select>
                        </span>
                    </div>
                </div>*@
            <div class="row row-cols-1 row-cols-md-2" style="margin-top: 100px;">
                @foreach (Course course in Model)
                {
                    var c = _context.CourseComments
                     .Where(x => x.CourseId == course.CourseId && !x.isAdmin)
                     .ToList();

                    var avgRating = 0;

                    if (c.Count != 0)
                    {
                        avgRating = (int)c.Average(x => x.Rating);
                    }

                    var entrolled = _context.CourseComments
                         .Where(x => x.CourseId == course.CourseId && !x.isAdmin)
                         .Count();

                    <div class="col mb-4">
                        <div class="card" style="height: 500px;">
                            <a href="/Account/ShowCourse?courseId=@course.CourseId">
                                <img src="@Url.Content(course.Avatar)" class="p-3 card-img-top" alt="..." style="height: 200px">
                            </a>
                            <div class="card-body">
                                <h5 class="card-title">@course.Title</h5>
                                <p class="card-text">@course.ShortDesciption</p>
                            </div>
                            @if (avgRating == 0)
                            {
                                <div class="m-3">
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <p class="mt-1"><b>Рейтинг: @avgRating</b> | студентов проголосовало @entrolled</p>

                                </div>
                            }
                            @if (avgRating == 1)
                            {
                                <div class="m-3">
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <p class="mt-1"><b>Рейтинг: @avgRating</b> | студентов проголосовало @entrolled</p>

                                </div>
                            }
                            @if (avgRating == 2)
                            {
                                <div class="m-3">
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <p class="mt-1"><b>Рейтинг: @avgRating</b> | студентов проголосовало @entrolled</p>

                                </div>
                            }
                            @if (avgRating == 3)
                            {
                                <div class="m-3">
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <p class="mt-1"><b>Рейтинг: @avgRating</b> | студентов проголосовало @entrolled</p>

                                </div>
                            }
                            @if (avgRating == 4)
                            {
                                <div class="m-3">
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-secondary" style="font-size: 25px">★</span>
                                    <p class="mt-1"><b>Рейтинг: @avgRating</b> | студентов проголосовало @entrolled</p>

                                </div>
                            }
                            @if (avgRating == 5)
                            {
                                <div class="m-3">
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <span class="text-warning" style="font-size: 25px">★</span>
                                    <p class="mt-1"><b>Рейтинг: @avgRating</b> | студентов проголосовало @entrolled</p>

                                </div>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

